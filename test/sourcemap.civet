{ compile } from ../source/main.civet
assert from assert

{ SourceMap, base64Encode } from ../source/sourcemap.civet

describe "source map", ->
  it "should parse from base64Encoded", ->
    src := """
      x := a + 3
      y++

      y = x + a
    """

    {sourceMap} := await compile src,
      sourceMap: true

    srcMapJSON := sourceMap.json("yo.civet", "yo.ts")

    base64Encoded := base64Encode JSON.stringify(srcMapJSON)

    parsed := SourceMap.parseWithLines base64Encoded

    assert.deepEqual parsed.lines, sourceMap.lines
