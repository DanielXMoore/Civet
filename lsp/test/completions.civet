assert from node:assert

{ getLanguageServer, resolveByProject, prepareDocument } from ./utils.civet

requestCompletions := (fileName: string, languageId: string, content: string) =>
  offset := content.indexOf "|"
  assert.notEqual offset, -1
  content = content[..offset - 1] + content[offset + 1..]

  server := await getLanguageServer()
  document .= await prepareDocument fileName, languageId, content

  position := document.positionAt(offset)
  return await server.sendCompletionRequest document.uri, position
  assert.notEqual return.value, undefined

describe "Completions", =>
  it "obejct field", async =>
    completions := await requestCompletions
      resolveByProject("./index.civet")
      "civet"
      ```
      foo := name: 'foo', type: 'string', description: 'foo'
      foo.n|
      ```
    ['completions', completions] |> console.log
